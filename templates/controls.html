{% extends "base.html" %}

{% block title %}DomSafe - Device Controls{% endblock %}

{% block content %}
<h1 class="page-title">Device Controls</h1>

<div class="card">
    <div class="card-header">üéõÔ∏è System Devices</div>
    <p style="color: #6b7280; margin-bottom: 2rem;">
        Control all connected devices from this central panel. Toggle devices on or off to manage your home security system.
    </p>

    <div class="grid grid-3">
        <div class="device-control">
            <div class="device-info">
                <div class="device-icon">üîî</div>
                <div>
                    <div class="device-name">System</div>
                    <div class="device-status" id="system-status">OFF</div>
                </div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="system-toggle" onchange="toggleDevice('system', this)">
                <span class="slider"></span>
            </label>
        </div>

        <div class="device-control">
            <div class="device-info">
                <div class="device-icon">üì∫</div>
                <div>
                    <div class="device-name">Screen</div>
                    <div class="device-status" id="screen-status">ON</div>
                </div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="screen-toggle" checked onchange="toggleDevice('screen', this)">
                <span class="slider"></span>
            </label>
        </div>

        <div class="device-control">
            <div class="device-info">
                <div class="device-icon">üí°</div>
                <div>
                    <div class="device-name">Lights</div>
                    <div class="device-status" id="light-status">ON</div>
                </div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="light-toggle" checked onchange="toggleDevice('light', this)">
                <span class="slider"></span>
            </label>
        </div>

        <div class="device-control">
            <div class="device-info">
                <div class="device-icon">üîä</div>
                <div>
                    <div class="device-name">Buzzer</div>
                    <div class="device-status" id="buzzer-status">ON</div>
                </div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="buzzer-toggle" checked onchange="toggleDevice('buzzer', this)">
                <span class="slider"></span>
            </label>
        </div>

        <div class="device-control">
            <div class="device-info">
                <div class="device-icon">üïê</div>
                <div>
                    <div class="device-name">Clock</div>
                    <div class="device-status" id="clock-status">ON</div>
                </div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="clock-toggle" checked onchange="toggleDevice('clock', this)">
                <span class="slider"></span>
            </label>
        </div>

        <div class="device-control">
            <div class="device-info">
                <div class="device-icon">üå°Ô∏è</div>
                <div>
                    <div class="device-name">DHT Sensor</div>
                    <div class="device-status" id="dht-status">ON</div>
                </div>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="dht-toggle" checked onchange="toggleDevice('dht', this)">
                <span class="slider"></span>
            </label>
        </div>
    </div>
</div>

<div class="card" style="margin-top: 2rem;">
    <div class="card-header">‚ÑπÔ∏è Device Information</div>
    <div style="color: #6b7280; line-height: 1.8;">
        <p style="margin-bottom: 1rem;"><strong style="color: #333;">System:</strong> Main security system control. Arms/disarms the alarm.</p>
        <p style="margin-bottom: 1rem;"><strong style="color: #333;">Screen:</strong> Display panel showing system status and sensor readings.</p>
        <p style="margin-bottom: 1rem;"><strong style="color: #333;">Lights:</strong> Visual indicators and ambient lighting.</p>
        <p style="margin-bottom: 1rem;"><strong style="color: #333;">Buzzer:</strong> Audio alarm for security alerts.</p>
        <p style="margin-bottom: 1rem;"><strong style="color: #333;">Clock:</strong> Real-time clock display on the system panel.</p>
        <p><strong style="color: #333;">DHT Sensor:</strong> Temperature and humidity sensor module.</p>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Toggle device function
    async function toggleDevice(device, checkbox) {
        const action = checkbox.checked ? 'ON' : 'OFF';

        const result = await apiCall('/api/control', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ device, action })
        });

        if (result.success) {
            // Update status display
            const statusId = `${device}-status`;
            document.getElementById(statusId).textContent = action;
        } else {
            // Revert checkbox if failed
            checkbox.checked = !checkbox.checked;
        }
    }
</script>
{% endblock %}