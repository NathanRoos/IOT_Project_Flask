{% extends "base.html" %}

{% block title %}DomSafe - Dashboard{% endblock %}

{% block content %}
<h1 class="page-title">System Overview</h1>

<div class="grid grid-3">
    <div class="metric-card">
        <div class="metric-icon">ğŸŒ¡ï¸</div>
        <div class="metric-value" id="temp-value">--</div>
        <div class="metric-label">Temperature (Â°C)</div>
        <div class="metric-label" style="font-size: 0.8rem; margin-top: 0.5rem;" id="temp-update">Loading...</div>
    </div>

    <div class="metric-card">
        <div class="metric-icon">ğŸ’§</div>
        <div class="metric-value" id="humidity-value">--</div>
        <div class="metric-label">Humidity (%)</div>
        <div class="metric-label" style="font-size: 0.8rem; margin-top: 0.5rem;" id="humidity-update">Loading...</div>
    </div>

    <div class="metric-card">
        <div class="metric-icon">ğŸ””</div>
        <div class="metric-value" id="status-value">--</div>
        <div class="metric-label">System Status</div>
        <div class="metric-label" style="font-size: 0.8rem; margin-top: 0.5rem;" id="status-update">Loading...</div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Fetch live data from Adafruit IO
    async function fetchLiveData() {
        const data = await apiCall('/api/live-data');

        if (data.success) {
            // Update temperature
            if (data.data.temperature !== null) {
                document.getElementById('temp-value').textContent = data.data.temperature.toFixed(1);
                document.getElementById('temp-update').textContent = `Updated: ${formatTimestamp(data.data.timestamp)}`;
            }

            // Update humidity
            if (data.data.humidity !== null) {
                document.getElementById('humidity-value').textContent = data.data.humidity.toFixed(1);
                document.getElementById('humidity-update').textContent = `Updated: ${formatTimestamp(data.data.timestamp)}`;
            }

            // Update security status
            const status = data.data.alarm_status || 'unknown';
            document.getElementById('status-value').textContent = status.toUpperCase();
        }
    }

    // Initialize
    fetchLiveData();
    setInterval(fetchLiveData, 5000); // Update every 5 seconds
</script>
{% endblock %}